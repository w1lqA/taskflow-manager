<div class="modal-form">
    <div class="modal-header">
        <h2 class="text-xl font-semibold text-white">
            {% if task %}Редактировать задачу{% else %}Новая задача{% endif %}
        </h2>
    </div>
    
    <div class="modal-content space-y-5">
        <form id="taskForm" onsubmit="submitTaskForm(event)">
            {% csrf_token %}
            
            <!-- Название -->
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">
                    Название задачи *
                </label>
                <input type="text" name="title" 
                       value="{{ task.title|default:'' }}" 
                       required
                       class="w-full px-4 py-2.5 bg-white/5 border border-gray-700/50 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500/50 transition">
            </div>

            <!-- Описание -->
            <div>
                <label class="block text-sm font-medium text-gray-300 mb-2">
                    Описание
                </label>
                <textarea name="description" rows="3"
                          class="w-full px-4 py-2.5 bg-white/5 border border-gray-700/50 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500/50 transition">{{ task.description|default:'' }}</textarea>
            </div>

            <!-- Проект и статус -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <!-- Проект -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">
                        Проект
                    </label>
                    <select name="project"
                            class="w-full px-4 py-2.5 bg-white/5 border border-gray-700/50 rounded-lg text-white focus:outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500/50 transition">
                        <option value="">-- Без проекта --</option>
                        {% for project in projects %}
                        <option value="{{ project.pk }}" 
                                {% if task and task.project.pk == project.pk %}selected{% endif %}>
                            {{ project.title }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Статус -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">
                        Статус
                    </label>
                    <select name="status"
                            class="w-full px-4 py-2.5 bg-white/5 border border-gray-700/50 rounded-lg text-white focus:outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500/50 transition">
                        <option value="todo" {% if task and task.status == 'todo' %}selected{% endif %}>К выполнению</option>
                        <option value="in_progress" {% if task and task.status == 'in_progress' %}selected{% endif %}>В процессе</option>
                        <option value="done" {% if task and task.status == 'done' %}selected{% endif %}>Выполнено</option>
                        <option value="backlog" {% if task and task.status == 'backlog' %}selected{% endif %}>Отложено</option>
                    </select>
                </div>
            </div>

            <!-- Приоритет и срок -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <!-- Приоритет -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">
                        Приоритет (1-высокий, 5-низкий)
                    </label>
                    <div class="flex items-center gap-4">
                        <input type="range" name="priority" min="1" max="5" 
                               value="{{ task.priority|default:'3' }}"
                               class="flex-1 h-1.5 bg-gray-700/50 rounded-lg appearance-none cursor-pointer slider"
                               oninput="updatePriorityValue(this)">
                        <span id="priorityValue" class="text-lg font-bold text-blue-400 min-w-[20px]">
                            {{ task.priority|default:'3' }}
                        </span>
                    </div>
                </div>

                <!-- Срок выполнения -->
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">
                        Срок выполнения
                    </label>
                    <input type="datetime-local" name="due_date" 
                           value="{% if task and task.due_date %}{{ task.due_date|date:'Y-m-d\\TH:i' }}{% endif %}"
                           class="w-full px-4 py-2.5 bg-white/5 border border-gray-700/50 rounded-lg text-white focus:outline-none focus:ring-1 focus:ring-blue-500/50 focus:border-blue-500/50 transition">
                </div>
            </div>
        </form>
    </div>

    <div class="modal-footer">
        <button onclick="closeModal()" 
                class="glass-btn px-4 py-2.5 rounded-lg text-sm text-gray-300 hover:text-white transition-colors">
            Отмена
        </button>
        <button type="submit" form="taskForm"
                class="glass-btn-primary px-5 py-2.5 rounded-lg text-sm font-medium text-white hover:bg-blue-500/30 transition-colors">
            {% if task %}Сохранить изменения{% else %}Создать задачу{% endif %}
        </button>
    </div>

    <script>
        // Обновление значения приоритета
        function updatePriorityValue(slider) {
            document.getElementById('priorityValue').textContent = slider.value;
        }
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            const slider = document.querySelector('.slider');
            if (slider) {
                updatePriorityValue(slider);
            }
        });
    </script>
</div>